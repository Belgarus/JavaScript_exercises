<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mandelbrot Set Visualization</title>
    <link rel="stylesheet" href="src/styles/style.css">
</head>
<body>
    <div id="controls">
        <h1>Mandelbrot Set</h1>
        <div class="instructions">
            <p>Mouse wheel: Zoom in/out</p>
            <p>Click and drag: Pan around</p>
        </div>
        <button id="resetButton">Reset View</button>
    </div>
    <canvas id="mandelbrotCanvas"></canvas>
    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('mandelbrotCanvas');
            const ctx = canvas.getContext('2d');
            const resetButton = document.getElementById('resetButton');

            let zoom = 1;
            let offsetX = 0;
            let offsetY = 0;

            function mandelbrot(real, imaginary) {
                let x = 0;
                let y = 0;
                let iteration = 0;
                const maxIterations = 255;

                while (x * x + y * y < 4 && iteration < maxIterations) {
                    const xTemp = x * x - y * y + real;
                    y = 2 * x * y + imaginary;
                    x = xTemp;
                    iteration++;
                }

                return iteration;
            }

            function getColor(value) {
                const color = { r: 0, g: 0, b: 0 };
                if (value === 255) {
                    return color; // Black for points in the Mandelbrot set
                }
                const hue = value % 256;
                color.r = hue;
                color.g = (hue * 2) % 256;
                color.b = (hue * 3) % 256;
                return color;
            }

            function drawMandelbrot() {
                const imageData = ctx.createImageData(canvas.width, canvas.height);
                const data = imageData.data;
                
                const scale = Math.min(canvas.width, canvas.height) / 4;

                for (let x = 0; x < canvas.width; x++) {
                    for (let y = 0; y < canvas.height; y++) {
                        const real = (x - canvas.width / 2) / (scale * zoom) + offsetX;
                        const imaginary = (y - canvas.height / 2) / (scale * zoom) + offsetY;
                        const value = mandelbrot(real, imaginary);
                        const color = getColor(value);
                        const pixelIndex = (x + y * canvas.width) * 4;

                        data[pixelIndex] = color.r;
                        data[pixelIndex + 1] = color.g;
                        data[pixelIndex + 2] = color.b;
                        data[pixelIndex + 3] = 255; // Alpha
                    }
                }

                ctx.putImageData(imageData, 0, 0);
            }

            function initializeCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                drawMandelbrot();
            }

            function resetView() {
                zoom = 1;
                offsetX = 0;
                offsetY = 0;
                drawMandelbrot();
            }

            // Event Listeners
            canvas.addEventListener('wheel', (event) => {
                event.preventDefault();
                const zoomFactor = 1.1;
                const mouseX = event.clientX;
                const mouseY = event.clientY;
                
                // Calculate where the mouse is pointing in the complex plane
                const pointX = (mouseX - canvas.width / 2) / (canvas.width / 4 * zoom) + offsetX;
                const pointY = (mouseY - canvas.height / 2) / (canvas.height / 4 * zoom) + offsetY;
                
                if (event.deltaY < 0) {
                    zoom *= zoomFactor;
                } else {
                    zoom /= zoomFactor;
                }
                
                // Adjust offset to keep the point under the mouse
                offsetX = pointX - (mouseX - canvas.width / 2) / (canvas.width / 4 * zoom);
                offsetY = pointY - (mouseY - canvas.height / 2) / (canvas.height / 4 * zoom);
                
                drawMandelbrot();
            });

            canvas.addEventListener('mousemove', (event) => {
                if (event.buttons === 1) { // Left mouse button
                    offsetX -= event.movementX / (canvas.width / 4 * zoom);
                    offsetY -= event.movementY / (canvas.height / 4 * zoom);
                    drawMandelbrot();
                }
            });

            resetButton.addEventListener('click', resetView);
            window.addEventListener('resize', initializeCanvas);

            // Initial render
            initializeCanvas();
        });
    </script>
</body>
</html>